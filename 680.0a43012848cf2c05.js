"use strict";(self.webpackChunkprtflio=self.webpackChunkprtflio||[]).push([[680],{680:(os,Dt,he)=>{he.r(Dt),he.d(Dt,{AboutModule:()=>$r});var Bn=he(6895),zn=he(4463),Ot=he(1380),Nn=he(7520),Un=he(2340),h=he(2329);const Ct={type:"change"},ct={type:"start"},Ft={type:"end"};class Bt extends h.pBf{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new h.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:h.RsA.ROTATE,MIDDLE:h.RsA.DOLLY,RIGHT:h.RsA.PAN},this.touches={ONE:h.QmN.ROTATE,TWO:h.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(y){y.addEventListener("keydown",Pt),this._domElementKeyEvents=y},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Pt),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(Ct),t.update(),s=r.NONE},this.update=function(){const y=new h.Pa4,L=(new h._fP).setFromUnitVectors(e.up,new h.Pa4(0,1,0)),q=L.clone().invert(),ee=new h.Pa4,ce=new h._fP,De=2*Math.PI;return function(){const Fn=t.object.position;y.copy(Fn).sub(t.target),y.applyQuaternion(L),a.setFromVector3(y),t.autoRotate&&s===r.NONE&&R(function I(){return 2*Math.PI/60/60*t.autoRotateSpeed}()),t.enableDamping?(a.theta+=c.theta*t.dampingFactor,a.phi+=c.phi*t.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let de=t.minAzimuthAngle,me=t.maxAzimuthAngle;return isFinite(de)&&isFinite(me)&&(de<-Math.PI?de+=De:de>Math.PI&&(de-=De),me<-Math.PI?me+=De:me>Math.PI&&(me-=De),a.theta=de<=me?Math.max(de,Math.min(me,a.theta)):a.theta>(de+me)/2?Math.max(de,a.theta):Math.min(me,a.theta)),a.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(t.minDistance,Math.min(t.maxDistance,a.radius)),!0===t.enableDamping?t.target.addScaledVector(f,t.dampingFactor):t.target.add(f),y.setFromSpherical(a),y.applyQuaternion(q),Fn.copy(t.target).add(y),t.object.lookAt(t.target),!0===t.enableDamping?(c.theta*=1-t.dampingFactor,c.phi*=1-t.dampingFactor,f.multiplyScalar(1-t.dampingFactor)):(c.set(0,0,0),f.set(0,0,0)),l=1,!!(u||ee.distanceToSquared(t.object.position)>o||8*(1-ce.dot(t.object.quaternion))>o)&&(t.dispatchEvent(Ct),ee.copy(t.object.position),ce.copy(t.object.quaternion),u=!1,!0)}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",Dn),t.domElement.removeEventListener("pointerdown",ke),t.domElement.removeEventListener("pointercancel",Pn),t.domElement.removeEventListener("wheel",kn),t.domElement.removeEventListener("pointermove",_t),t.domElement.removeEventListener("pointerup",Lt),null!==t._domElementKeyEvents&&(t._domElementKeyEvents.removeEventListener("keydown",Pt),t._domElementKeyEvents=null)};const t=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,a=new h.$V,c=new h.$V;let l=1;const f=new h.Pa4;let u=!1;const p=new h.FM8,d=new h.FM8,m=new h.FM8,g=new h.FM8,v=new h.FM8,A=new h.FM8,x=new h.FM8,w=new h.FM8,b=new h.FM8,E=[],M={};function T(){return Math.pow(.95,t.zoomSpeed)}function R(y){c.theta-=y}function S(y){c.phi-=y}const C=function(){const y=new h.Pa4;return function(q,ee){y.setFromMatrixColumn(ee,0),y.multiplyScalar(-q),f.add(y)}}(),P=function(){const y=new h.Pa4;return function(q,ee){!0===t.screenSpacePanning?y.setFromMatrixColumn(ee,1):(y.setFromMatrixColumn(ee,0),y.crossVectors(t.object.up,y)),y.multiplyScalar(q),f.add(y)}}(),_=function(){const y=new h.Pa4;return function(q,ee){const ce=t.domElement;if(t.object.isPerspectiveCamera){y.copy(t.object.position).sub(t.target);let at=y.length();at*=Math.tan(t.object.fov/2*Math.PI/180),C(2*q*at/ce.clientHeight,t.object.matrix),P(2*ee*at/ce.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(C(q*(t.object.right-t.object.left)/t.object.zoom/ce.clientWidth,t.object.matrix),P(ee*(t.object.top-t.object.bottom)/t.object.zoom/ce.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function k(y){t.object.isPerspectiveCamera?l/=y:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*y)),t.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function D(y){t.object.isPerspectiveCamera?l*=y:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/y)),t.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function F(y){p.set(y.clientX,y.clientY)}function X(y){g.set(y.clientX,y.clientY)}function H(){1===E.length?p.set(E[0].pageX,E[0].pageY):p.set(.5*(E[0].pageX+E[1].pageX),.5*(E[0].pageY+E[1].pageY))}function U(){1===E.length?g.set(E[0].pageX,E[0].pageY):g.set(.5*(E[0].pageX+E[1].pageX),.5*(E[0].pageY+E[1].pageY))}function $(){const y=E[0].pageX-E[1].pageX,L=E[0].pageY-E[1].pageY,q=Math.sqrt(y*y+L*L);x.set(0,q)}function Pe(y){if(1==E.length)d.set(y.pageX,y.pageY);else{const q=kt(y);d.set(.5*(y.pageX+q.x),.5*(y.pageY+q.y))}m.subVectors(d,p).multiplyScalar(t.rotateSpeed);const L=t.domElement;R(2*Math.PI*m.x/L.clientHeight),S(2*Math.PI*m.y/L.clientHeight),p.copy(d)}function se(y){if(1===E.length)v.set(y.pageX,y.pageY);else{const L=kt(y);v.set(.5*(y.pageX+L.x),.5*(y.pageY+L.y))}A.subVectors(v,g).multiplyScalar(t.panSpeed),_(A.x,A.y),g.copy(v)}function pe(y){const L=kt(y),q=y.pageX-L.x,ee=y.pageY-L.y,ce=Math.sqrt(q*q+ee*ee);w.set(0,ce),b.set(0,Math.pow(w.y/x.y,t.zoomSpeed)),k(b.y),x.copy(w)}function ke(y){!1!==t.enabled&&(0===E.length&&(t.domElement.setPointerCapture(y.pointerId),t.domElement.addEventListener("pointermove",_t),t.domElement.addEventListener("pointerup",Lt)),function is(y){E.push(y)}(y),"touch"===y.pointerType?function rs(y){switch(Cn(y),E.length){case 1:switch(t.touches.ONE){case h.QmN.ROTATE:if(!1===t.enableRotate)return;H(),s=r.TOUCH_ROTATE;break;case h.QmN.PAN:if(!1===t.enablePan)return;U(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(t.touches.TWO){case h.QmN.DOLLY_PAN:if(!1===t.enableZoom&&!1===t.enablePan)return;(function fe(){t.enableZoom&&$(),t.enablePan&&U()})(),s=r.TOUCH_DOLLY_PAN;break;case h.QmN.DOLLY_ROTATE:if(!1===t.enableZoom&&!1===t.enableRotate)return;(function re(){t.enableZoom&&$(),t.enableRotate&&H()})(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&t.dispatchEvent(ct)}(y):function ts(y){let L;switch(y.button){case 0:L=t.mouseButtons.LEFT;break;case 1:L=t.mouseButtons.MIDDLE;break;case 2:L=t.mouseButtons.RIGHT;break;default:L=-1}switch(L){case h.RsA.DOLLY:if(!1===t.enableZoom)return;(function N(y){x.set(y.clientX,y.clientY)})(y),s=r.DOLLY;break;case h.RsA.ROTATE:if(y.ctrlKey||y.metaKey||y.shiftKey){if(!1===t.enablePan)return;X(y),s=r.PAN}else{if(!1===t.enableRotate)return;F(y),s=r.ROTATE}break;case h.RsA.PAN:if(y.ctrlKey||y.metaKey||y.shiftKey){if(!1===t.enableRotate)return;F(y),s=r.ROTATE}else{if(!1===t.enablePan)return;X(y),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&t.dispatchEvent(ct)}(y))}function _t(y){!1!==t.enabled&&("touch"===y.pointerType?function ss(y){switch(Cn(y),s){case r.TOUCH_ROTATE:if(!1===t.enableRotate)return;Pe(y),t.update();break;case r.TOUCH_PAN:if(!1===t.enablePan)return;se(y),t.update();break;case r.TOUCH_DOLLY_PAN:if(!1===t.enableZoom&&!1===t.enablePan)return;(function ot(y){t.enableZoom&&pe(y),t.enablePan&&se(y)})(y),t.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===t.enableZoom&&!1===t.enableRotate)return;(function es(y){t.enableZoom&&pe(y),t.enableRotate&&Pe(y)})(y),t.update();break;default:s=r.NONE}}(y):function ns(y){switch(s){case r.ROTATE:if(!1===t.enableRotate)return;!function K(y){d.set(y.clientX,y.clientY),m.subVectors(d,p).multiplyScalar(t.rotateSpeed);const L=t.domElement;R(2*Math.PI*m.x/L.clientHeight),S(2*Math.PI*m.y/L.clientHeight),p.copy(d),t.update()}(y);break;case r.DOLLY:if(!1===t.enableZoom)return;!function J(y){w.set(y.clientX,y.clientY),b.subVectors(w,x),b.y>0?k(T()):b.y<0&&D(T()),x.copy(w),t.update()}(y);break;case r.PAN:if(!1===t.enablePan)return;!function Z(y){v.set(y.clientX,y.clientY),A.subVectors(v,g).multiplyScalar(t.panSpeed),_(A.x,A.y),g.copy(v),t.update()}(y)}}(y))}function Lt(y){On(y),0===E.length&&(t.domElement.releasePointerCapture(y.pointerId),t.domElement.removeEventListener("pointermove",_t),t.domElement.removeEventListener("pointerup",Lt)),t.dispatchEvent(Ft),s=r.NONE}function Pn(y){On(y)}function kn(y){!1===t.enabled||!1===t.enableZoom||s!==r.NONE||(y.preventDefault(),t.dispatchEvent(ct),function te(y){y.deltaY<0?D(T()):y.deltaY>0&&k(T()),t.update()}(y),t.dispatchEvent(Ft))}function Pt(y){!1===t.enabled||!1===t.enablePan||function Y(y){let L=!1;switch(y.code){case t.keys.UP:y.ctrlKey||y.metaKey||y.shiftKey?S(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):_(0,t.keyPanSpeed),L=!0;break;case t.keys.BOTTOM:y.ctrlKey||y.metaKey||y.shiftKey?S(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):_(0,-t.keyPanSpeed),L=!0;break;case t.keys.LEFT:y.ctrlKey||y.metaKey||y.shiftKey?R(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):_(t.keyPanSpeed,0),L=!0;break;case t.keys.RIGHT:y.ctrlKey||y.metaKey||y.shiftKey?R(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):_(-t.keyPanSpeed,0),L=!0}L&&(y.preventDefault(),t.update())}(y)}function Dn(y){!1!==t.enabled&&y.preventDefault()}function On(y){delete M[y.pointerId];for(let L=0;L<E.length;L++)if(E[L].pointerId==y.pointerId)return void E.splice(L,1)}function Cn(y){let L=M[y.pointerId];void 0===L&&(L=new h.FM8,M[y.pointerId]=L),L.set(y.pageX,y.pageY)}function kt(y){return M[(y.pointerId===E[0].pointerId?E[1]:E[0]).pointerId]}t.domElement.addEventListener("contextmenu",Dn),t.domElement.addEventListener("pointerdown",ke),t.domElement.addEventListener("pointercancel",Pn),t.domElement.addEventListener("wheel",kn,{passive:!1}),this.update()}}function Nt(i,e){if(e===h.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===h.z$h||e===h.UlW){let n=i.getIndex();if(null===n){const o=[],a=i.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i;for(let c=0;c<a.count;c++)o.push(c);i.setIndex(o),n=i.getIndex()}const t=n.count-2,r=[];if(e===h.z$h)for(let o=1;o<=t;o++)r.push(n.getX(0)),r.push(n.getX(o)),r.push(n.getX(o+1));else for(let o=0;o<t;o++)o%2==0?(r.push(n.getX(o)),r.push(n.getX(o+1)),r.push(n.getX(o+2))):(r.push(n.getX(o+2)),r.push(n.getX(o+1)),r.push(n.getX(o)));r.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=i.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}class Gn extends h.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Kn(n)}),this.register(function(n){return new $n(n)}),this.register(function(n){return new er(n)}),this.register(function(n){return new tr(n)}),this.register(function(n){return new Yn(n)}),this.register(function(n){return new Wn(n)}),this.register(function(n){return new qn(n)}),this.register(function(n){return new Qn(n)}),this.register(function(n){return new Xn(n)}),this.register(function(n){return new Jn(n)}),this.register(function(n){return new Zn(n)}),this.register(function(n){return new jn(n)}),this.register(function(n){return new nr(n)}),this.register(function(n){return new rr(n)})}load(e,n,t,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:h.Zp0.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){r?r(l):console.error(l),s.manager.itemError(e),s.manager.itemEnd(e)},c=new h.hH6(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{s.parse(l,o,function(f){n(f),s.manager.itemEnd(e)},a)}catch(f){a(f)}},t,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,r){let s;const o={},a={},c=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Ut){try{o[B.KHR_BINARY_GLTF]=new sr(e)}catch(u){return void(r&&r(u))}s=JSON.parse(o[B.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new yr(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const u=this.pluginCallbacks[f](l);a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let f=0;f<s.extensionsUsed.length;++f){const u=s.extensionsUsed[f],p=s.extensionsRequired||[];switch(u){case B.KHR_MATERIALS_UNLIT:o[u]=new Vn;break;case B.KHR_DRACO_MESH_COMPRESSION:o[u]=new ir(s,this.dracoLoader);break;case B.KHR_TEXTURE_TRANSFORM:o[u]=new or;break;case B.KHR_MESH_QUANTIZATION:o[u]=new ar;break;default:p.indexOf(u)>=0&&void 0===a[u]&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(t,r)}parseAsync(e,n){const t=this;return new Promise(function(r,s){t.parse(e,n,r,s)})}}function Hn(){let i={};return{get:function(e){return i[e]},add:function(e,n){i[e]=n},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const B={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class jn{constructor(e){this.parser=e,this.name=B.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,r=n.length;t<r;t++){const s=n[t];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let r=n.cache.get(t);if(r)return r;const s=n.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const f=new h.Ilk(16777215);void 0!==c.color&&f.fromArray(c.color);const u=void 0!==c.range?c.range:0;switch(c.type){case"directional":l=new h.Ox3(f),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new h.cek(f),l.distance=u;break;case"spot":l=new h.PMe(f),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,ye(l,c),void 0!==c.intensity&&(l.intensity=c.intensity),l.name=n.createUniqueName(c.name||"light_"+e),r=Promise.resolve(l),n.cache.add(t,r),r}getDependency(e,n){if("light"===e)return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,s=t.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(c){return t._getNodeRef(n.cache,a,c)})}}class Vn{constructor(){this.name=B.KHR_MATERIALS_UNLIT}getMaterialType(){return h.vBJ}extendParams(e,n,t){const r=[];e.color=new h.Ilk(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==s.baseColorTexture&&r.push(t.assignTexture(e,"map",s.baseColorTexture,h.knz))}return Promise.all(r)}}class Xn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return void 0!==s&&(n.emissiveIntensity=s),Promise.resolve()}}class Kn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(n.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(t.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(t.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(t.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const a=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new h.FM8(a,a)}return Promise.all(s)}}class Zn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(n.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(t.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(n.iridescenceIOR=o.iridescenceIor),void 0===n.iridescenceThicknessRange&&(n.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(t.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class Yn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new h.Ilk(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&n.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(n.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(t.assignTexture(n,"sheenColorMap",o.sheenColorTexture,h.knz)),void 0!==o.sheenRoughnessTexture&&s.push(t.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Wn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(n.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(t.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class qn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];n.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(t.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return n.attenuationColor=new h.Ilk(a[0],a[1],a[2]),Promise.all(s)}}class Qn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class Jn{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];n.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(t.assignTexture(n,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return n.specularColor=new h.Ilk(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(t.assignTexture(n,"specularColorMap",o.specularColorTexture,h.knz)),Promise.all(s)}}class $n{constructor(e){this.parser=e,this.name=B.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,r=t.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,o)}}class er{constructor(e){this.parser=e,this.name=B.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=r.images[o.source];let c=t.textureLoader;if(a.uri){const l=t.options.manager.getHandler(a.uri);null!==l&&(c=l)}return this.detectSupport().then(function(l){if(l)return t.loadTextureImage(e,o.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(1===n.height)}})),this.isSupported}}class tr{constructor(e){this.parser=e,this.name=B.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const o=s.extensions[n],a=r.images[o.source];let c=t.textureLoader;if(a.uri){const l=t.options.manager.getHandler(a.uri);null!==l&&(c=l)}return this.detectSupport().then(function(l){if(l)return t.loadTextureImage(e,o.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(1===n.height)}})),this.isSupported}}class nr{constructor(e){this.name=B.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const r=t.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const f=r.count,u=r.byteStride,p=new Uint8Array(a,r.byteOffset||0,r.byteLength||0);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(f,u,p,r.mode,r.filter).then(function(d){return d.buffer}):o.ready.then(function(){const d=new ArrayBuffer(f*u);return o.decodeGltfBuffer(new Uint8Array(d),f,u,p,r.mode,r.filter),d})})}return null}}class rr{constructor(e){this.name=B.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||void 0===t.mesh)return null;const r=n.meshes[t.mesh];for(const l of r.primitives)if(l.mode!==ie.TRIANGLES&&l.mode!==ie.TRIANGLE_STRIP&&l.mode!==ie.TRIANGLE_FAN&&void 0!==l.mode)return null;const o=t.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(f=>(c[l]=f,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const f=l.pop(),u=f.isGroup?f.children:[f],p=l[0].count,d=[];for(const m of u){const g=new h.yGw,v=new h.Pa4,A=new h._fP,x=new h.Pa4(1,1,1),w=new h.SPe(m.geometry,m.material,p);for(let b=0;b<p;b++)c.TRANSLATION&&v.fromBufferAttribute(c.TRANSLATION,b),c.ROTATION&&A.fromBufferAttribute(c.ROTATION,b),c.SCALE&&x.fromBufferAttribute(c.SCALE,b),w.setMatrixAt(b,g.compose(v,A,x));for(const b in c)"TRANSLATION"!==b&&"ROTATION"!==b&&"SCALE"!==b&&m.geometry.setAttribute(b,c[b]);h.Tme.prototype.copy.call(w,m),w.frustumCulled=!1,this.parser.assignFinalMaterial(w),d.push(w)}return f.isGroup?(f.clear(),f.add(...d),f):d[0]}))}}const Ut="glTF";class sr{constructor(e){this.name=B.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,12),t=new TextDecoder;if(this.header={magic:t.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Ut)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,1313821514===c){const l=new Uint8Array(e,12+o,a);this.content=t.decode(l)}else if(5130562===c){const l=12+o;this.body=e.slice(l,l+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ir{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=B.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const f in o){const u=ft[f]||f.toLowerCase();a[u]=o[f]}for(const f in e.attributes){const u=ft[f]||f.toLowerCase();if(void 0!==o[f]){const p=t.accessors[e.attributes[f]];l[u]=Ee[p.componentType].name,c[u]=!0===p.normalized}}return n.getDependency("bufferView",s).then(function(f){return new Promise(function(u){r.decodeDracoFile(f,function(p){for(const d in p.attributes){const m=p.attributes[d],g=c[d];void 0!==g&&(m.normalized=g)}u(p)},a,l)})})}}class or{constructor(){this.name=B.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return void 0!==n.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===n.offset&&void 0===n.rotation&&void 0===n.scale||(e=e.clone(),void 0!==n.offset&&e.offset.fromArray(n.offset),void 0!==n.rotation&&(e.rotation=n.rotation),void 0!==n.scale&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class ar{constructor(){this.name=B.KHR_MESH_QUANTIZATION}}class Ht extends h._C8{constructor(e,n,t,r){super(e,n,t,r)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)n[o]=t[s+o];return n}interpolate_(e,n,t,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=2*a,l=3*a,f=r-n,u=(t-n)/f,p=u*u,d=p*u,m=e*l,g=m-l,v=-2*d+3*p,A=d-p,x=1-v,w=A-p+u;for(let b=0;b!==a;b++)s[b]=x*o[g+b+a]+w*(o[g+b+c]*f)+v*o[m+b+a]+A*(o[m+b]*f);return s}}const cr=new h._fP;class lr extends Ht{interpolate_(e,n,t,r){const s=super.interpolate_(e,n,t,r);return cr.fromArray(s).normalize().toArray(s),s}}const ie={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ee={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jt={9728:h.TyD,9729:h.wem,9984:h.YLQ,9985:h.qyh,9986:h.aH4,9987:h.D1R},Vt={33071:h.uWy,33648:h.OoA,10497:h.rpg},ut={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ft={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ge={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ur={CUBICSPLINE:void 0,LINEAR:h.NMF,STEP:h.Syv};function Ce(i,e,n){for(const t in n.extensions)void 0===i[t]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function ye(i,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function pr(i,e){if(i.updateMorphTargets(),void 0!==e.weights)for(let n=0,t=e.weights.length;n<t;n++)i.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(i.morphTargetInfluences.length===n.length){i.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)i.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function dr(i){const e=i.extensions&&i.extensions[B.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+Xt(e.attributes):i.indices+":"+Xt(i.attributes)+":"+i.mode,n}function Xt(i){let e="";const n=Object.keys(i).sort();for(let t=0,r=n.length;t<r;t++)e+=n[t]+":"+i[n[t]]+";";return e}function pt(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const gr=new h.yGw;class yr{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Hn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,r=!1,s=-1;typeof navigator<"u"&&(t=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||t||r&&s<98?new h.dpR(this.options.manager):new h.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new h.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:t,userData:{}};Ce(s,a,r),ye(a,r),Promise.all(t._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let r=0,s=n.length;r<s;r++){const o=n[r].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(t[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){void 0!==n&&(void 0===e.refs[n]&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const r=t.clone(),s=(o,a)=>{const c=this.associations.get(o);null!=c&&this.associations.set(a,c);for(const[l,f]of o.children.entries())s(f,a.children[l])};return s(t,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const r=e(n[t]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let r=0;r<n.length;r++){const s=e(n[r]);s&&t.push(s)}return t}getDependency(e,n){const t=e+":"+n;let r=this.cache.get(t);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":r=this.loadCamera(n);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,n)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(t,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this;n=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(s,o){return t.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===e)return Promise.resolve(this.extensions[B.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){t.load(h.Zp0.resolveURL(n.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const s=n.byteOffset||0;return t.slice(s,s+(n.byteLength||0))})}loadAccessor(e){const n=this,t=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const o=ut[r.type],c=!0===r.normalized,l=new(0,Ee[r.componentType])(r.count*o);return Promise.resolve(new h.TlE(l,o,c))}const s=[];return s.push(void 0!==r.bufferView?this.getDependency("bufferView",r.bufferView):null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],c=ut[r.type],l=Ee[r.componentType],f=l.BYTES_PER_ELEMENT,p=r.byteOffset||0,d=void 0!==r.bufferView?t.bufferViews[r.bufferView].byteStride:void 0,m=!0===r.normalized;let g,v;if(d&&d!==f*c){const A=Math.floor(p/d),x="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+A+":"+r.count;let w=n.cache.get(x);w||(g=new l(a,A*d,r.count*d/f),w=new h.vpT(g,d/f),n.cache.add(x,w)),v=new h.kB5(w,c,p%d/f,m)}else g=null===a?new l(r.count*c):new l(a,p,r.count*c),v=new h.TlE(g,c,m);if(void 0!==r.sparse){const b=r.sparse.values.byteOffset||0,E=new(0,Ee[r.sparse.indices.componentType])(o[1],r.sparse.indices.byteOffset||0,r.sparse.count*ut.SCALAR),M=new l(o[2],b,r.sparse.count*c);null!==a&&(v=new h.TlE(v.array.slice(),v.itemSize,v.normalized));for(let I=0,T=E.length;I<T;I++){const R=E[I];if(v.setX(R,M[I*c]),c>=2&&v.setY(R,M[I*c+1]),c>=3&&v.setZ(R,M[I*c+2]),c>=4&&v.setW(R,M[I*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const n=this.json,s=n.textures[e].source,o=n.images[s];let a=this.textureLoader;if(o.uri){const c=this.options.manager.getHandler(o.uri);null!==c&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,n,t){const r=this,s=this.json,o=s.textures[e],a=s.images[n],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(n,t).then(function(f){f.flipY=!1,f.name=o.name||a.name||"";const p=(s.samplers||{})[o.sampler]||{};return f.magFilter=jt[p.magFilter]||h.wem,f.minFilter=jt[p.minFilter]||h.D1R,f.wrapS=Vt[p.wrapS]||h.rpg,f.wrapT=Vt[p.wrapT]||h.rpg,r.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,n){const r=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(u=>u.clone());const o=r.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(void 0!==o.bufferView)c=this.getDependency("bufferView",o.bufferView).then(function(u){l=!0;const p=new Blob([u],{type:o.mimeType});return c=a.createObjectURL(p),c});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(c).then(function(u){return new Promise(function(p,d){let m=p;!0===n.isImageBitmapLoader&&(m=function(g){const v=new h.xEZ(g);v.needsUpdate=!0,p(v)}),n.load(h.Zp0.resolveURL(u,s.path),m,void 0,d)})}).then(function(u){return!0===l&&a.revokeObjectURL(c),u.userData.mimeType=o.mimeType||function mr(i){return i.search(/\.jpe?g($|\?)/i)>0||0===i.search(/^data\:image\/jpeg/)?"image/jpeg":i.search(/\.webp($|\?)/i)>0||0===i.search(/^data\:image\/webp/)?"image/webp":"image/png"}(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=f,f}assignTexture(e,n,t,r){const s=this;return this.getDependency("texture",t.index).then(function(o){if(!o)return null;if(void 0!==t.texCoord&&0!=t.texCoord&&!("aoMap"===n&&1==t.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+t.texCoord+" for texture "+n+" not yet supported."),s.extensions[B.KHR_TEXTURE_TRANSFORM]){const a=void 0!==t.extensions?t.extensions[B.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(o);o=s.extensions[B.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,c)}}return void 0!==r&&(o.encoding=r),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const r=void 0===n.attributes.tangent,s=void 0!==n.attributes.color,o=void 0===n.attributes.normal;if(e.isPoints){const a="PointsMaterial:"+t.uuid;let c=this.cache.get(a);c||(c=new h.UY4,h.F5T.prototype.copy.call(c,t),c.color.copy(t.color),c.map=t.map,c.sizeAttenuation=!1,this.cache.add(a,c)),t=c}else if(e.isLine){const a="LineBasicMaterial:"+t.uuid;let c=this.cache.get(a);c||(c=new h.nls,h.F5T.prototype.copy.call(c,t),c.color.copy(t.color),this.cache.add(a,c)),t=c}if(r||s||o){let a="ClonedMaterial:"+t.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=t.clone(),s&&(c.vertexColors=!0),o&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(t))),t=c}t.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",n.attributes.uv),e.material=t}getMaterialType(){return h.Wid}loadMaterial(e){const n=this,r=this.extensions,s=this.json.materials[e];let o;const a={},l=[];if((s.extensions||{})[B.KHR_MATERIALS_UNLIT]){const u=r[B.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),l.push(u.extendParams(a,s,n))}else{const u=s.pbrMetallicRoughness||{};if(a.color=new h.Ilk(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const p=u.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}void 0!==u.baseColorTexture&&l.push(n.assignTexture(a,"map",u.baseColorTexture,h.knz)),a.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,a.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture&&(l.push(n.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=h.ehD);const f=s.alphaMode||"OPAQUE";if("BLEND"===f?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===f&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==h.vBJ&&(l.push(n.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new h.FM8(1,1),void 0!==s.normalTexture.scale)){const u=s.normalTexture.scale;a.normalScale.set(u,u)}return void 0!==s.occlusionTexture&&o!==h.vBJ&&(l.push(n.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==h.vBJ&&(a.emissive=(new h.Ilk).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==h.vBJ&&l.push(n.assignTexture(a,"emissiveMap",s.emissiveTexture,h.knz)),Promise.all(l).then(function(){const u=new o(a);return s.name&&(u.name=s.name),ye(u,s),n.associations.set(u,{materials:e}),s.extensions&&Ce(r,u,s),u})}createUniqueName(e){const n=h.iUV.sanitizeNodeName(e||"");let t=n;for(let r=1;this.nodeNamesUsed[t];++r)t=n+"_"+r;return this.nodeNamesUsed[t]=!0,t}loadGeometries(e){const n=this,t=this.extensions,r=this.primitiveCache;function s(a){return t[B.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(c){return Kt(c,a,n)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],f=dr(l),u=r[f];if(u)o.push(u.promise);else{let p;p=l.extensions&&l.extensions[B.KHR_DRACO_MESH_COMPRESSION]?s(l):Kt(new h.u9r,l,n),r[f]={primitive:l,promise:p},o.push(p)}}return Promise.all(o)}loadMesh(e){const n=this,r=this.extensions,s=this.json.meshes[e],o=s.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const f=void 0===o[c].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new h.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:h.Wl3})),i.DefaultMaterial):this.getDependency("material",o[c].material);a.push(f)}var i;return a.push(n.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),f=c[c.length-1],u=[];for(let d=0,m=f.length;d<m;d++){const g=f[d],v=o[d];let A;const x=l[d];if(v.mode===ie.TRIANGLES||v.mode===ie.TRIANGLE_STRIP||v.mode===ie.TRIANGLE_FAN||void 0===v.mode)A=!0===s.isSkinnedMesh?new h.TUv(g,x):new h.Kj0(g,x),!0===A.isSkinnedMesh&&A.normalizeSkinWeights(),v.mode===ie.TRIANGLE_STRIP?A.geometry=Nt(A.geometry,h.UlW):v.mode===ie.TRIANGLE_FAN&&(A.geometry=Nt(A.geometry,h.z$h));else if(v.mode===ie.LINES)A=new h.ejS(g,x);else if(v.mode===ie.LINE_STRIP)A=new h.x12(g,x);else if(v.mode===ie.LINE_LOOP)A=new h.blk(g,x);else{if(v.mode!==ie.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);A=new h.woe(g,x)}Object.keys(A.geometry.morphAttributes).length>0&&pr(A,s),A.name=n.createUniqueName(s.name||"mesh_"+e),ye(A,s),v.extensions&&Ce(r,A,v),n.assignFinalMaterial(A),u.push(A)}for(let d=0,m=u.length;d<m;d++)n.associations.set(u[d],{meshes:e,primitives:d});if(1===u.length)return u[0];const p=new h.ZAu;n.associations.set(p,{meshes:e});for(let d=0,m=u.length;d<m;d++)p.add(u[d]);return p})}loadCamera(e){let n;const t=this.json.cameras[e],r=t[t.type];if(r)return"perspective"===t.type?n=new h.cPb(h.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===t.type&&(n=new h.iKG(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),ye(n,t),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const n=this.json.skins[e],t=[];for(let r=0,s=n.joints.length;r<s;r++)t.push(this._loadNodeShallow(n.joints[r]));return t.push(void 0!==n.inverseBindMatrices?this.getDependency("accessor",n.inverseBindMatrices):null),Promise.all(t).then(function(r){const s=r.pop(),o=r,a=[],c=[];for(let l=0,f=o.length;l<f;l++){const u=o[l];if(u){a.push(u);const p=new h.yGw;null!==s&&p.fromArray(s.array,16*l),c.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new h.OdW(a,c)})}loadAnimation(e){const t=this.json.animations[e],r=[],s=[],o=[],a=[],c=[];for(let l=0,f=t.channels.length;l<f;l++){const u=t.channels[l],p=t.samplers[u.sampler],d=u.target,g=void 0!==t.parameters?t.parameters[p.input]:p.input,v=void 0!==t.parameters?t.parameters[p.output]:p.output;r.push(this.getDependency("node",d.node)),s.push(this.getDependency("accessor",g)),o.push(this.getDependency("accessor",v)),a.push(p),c.push(d)}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const f=l[0],u=l[1],p=l[2],d=l[3],m=l[4],g=[];for(let A=0,x=f.length;A<x;A++){const w=f[A],b=u[A],E=p[A],M=d[A],I=m[A];if(void 0===w)continue;let T;switch(w.updateMatrix(),ge[I.path]){case ge.weights:T=h.dUE;break;case ge.rotation:T=h.iLg;break;default:T=h.yC1}const R=w.name?w.name:w.uuid,S=void 0!==M.interpolation?ur[M.interpolation]:h.NMF,C=[];ge[I.path]===ge.weights?w.traverse(function(_){_.morphTargetInfluences&&C.push(_.name?_.name:_.uuid)}):C.push(R);let P=E.array;if(E.normalized){const _=pt(P.constructor),k=new Float32Array(P.length);for(let D=0,F=P.length;D<F;D++)k[D]=P[D]*_;P=k}for(let _=0,k=C.length;_<k;_++){const D=new T(C[_]+"."+ge[I.path],b.array,P,S);"CUBICSPLINE"===M.interpolation&&(D.createInterpolant=function(N){return new(this instanceof h.iLg?lr:Ht)(this.times,this.values,this.getValueSize()/3,N)},D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(D)}}return new h.m7l(t.name?t.name:"animation_"+e,void 0,g)})}createNodeMesh(e){const t=this,r=this.json.nodes[e];return void 0===r.mesh?null:t.getDependency("mesh",r.mesh).then(function(s){const o=t._getNodeRef(t.meshCache,r.mesh,s);return void 0!==r.weights&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=r.weights.length;c<l;c++)a.morphTargetInfluences[c]=r.weights[c]}),o})}loadNode(e){const t=this,r=this.json.nodes[e],s=t._loadNodeShallow(e),o=[],a=r.children||[];for(let l=0,f=a.length;l<f;l++)o.push(t.getDependency("node",a[l]));const c=void 0===r.skin?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),c]).then(function(l){const f=l[0],u=l[1],p=l[2];null!==p&&f.traverse(function(d){!d.isSkinnedMesh||d.bind(p,gr)});for(let d=0,m=u.length;d<m;d++)f.add(u[d]);return f})}_loadNodeShallow(e){const t=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=this.json.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],c=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),void 0!==s.camera&&a.push(r.getDependency("camera",s.camera).then(function(l){return r._getNodeRef(r.cameraCache,s.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let f;if(f=!0===s.isBone?new h.N$j:l.length>1?new h.ZAu:1===l.length?l[0]:new h.Tme,f!==l[0])for(let u=0,p=l.length;u<p;u++)f.add(l[u]);if(s.name&&(f.userData.name=s.name,f.name=o),ye(f,s),s.extensions&&Ce(t,f,s),void 0!==s.matrix){const u=new h.yGw;u.fromArray(s.matrix),f.applyMatrix4(u)}else void 0!==s.translation&&f.position.fromArray(s.translation),void 0!==s.rotation&&f.quaternion.fromArray(s.rotation),void 0!==s.scale&&f.scale.fromArray(s.scale);return r.associations.has(f)||r.associations.set(f,{}),r.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],r=this,s=new h.ZAu;t.name&&(s.name=r.createUniqueName(t.name)),ye(s,t),t.extensions&&Ce(n,s,t);const o=t.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(r.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let f=0,u=c.length;f<u;f++)s.add(c[f]);return r.associations=(f=>{const u=new Map;for(const[p,d]of r.associations)(p instanceof h.F5T||p instanceof h.xEZ)&&u.set(p,d);return f.traverse(p=>{const d=r.associations.get(p);null!=d&&u.set(p,d)}),u})(s),s})}}function Kt(i,e,n){const t=e.attributes,r=[];function s(o,a){return n.getDependency("accessor",o).then(function(c){i.setAttribute(a,c)})}for(const o in t){const a=ft[o]||o.toLowerCase();a in i.attributes||r.push(s(t[o],a))}if(void 0!==e.indices&&!i.index){const o=n.getDependency("accessor",e.indices).then(function(a){i.setIndex(a)});r.push(o)}return ye(i,e),function vr(i,e,n){const t=e.attributes,r=new h.ZzF;if(void 0===t.POSITION)return;{const a=n.json.accessors[t.POSITION],c=a.min,l=a.max;if(void 0===c||void 0===l)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new h.Pa4(c[0],c[1],c[2]),new h.Pa4(l[0],l[1],l[2])),a.normalized){const f=pt(Ee[a.componentType]);r.min.multiplyScalar(f),r.max.multiplyScalar(f)}}const s=e.targets;if(void 0!==s){const a=new h.Pa4,c=new h.Pa4;for(let l=0,f=s.length;l<f;l++){const u=s[l];if(void 0!==u.POSITION){const p=n.json.accessors[u.POSITION],d=p.min,m=p.max;if(void 0!==d&&void 0!==m){if(c.setX(Math.max(Math.abs(d[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(d[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(d[2]),Math.abs(m[2]))),p.normalized){const g=pt(Ee[p.componentType]);c.multiplyScalar(g)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}i.boundingBox=r;const o=new h.aLr;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,i.boundingSphere=o}(i,e,n),Promise.all(r).then(function(){return void 0!==e.targets?function hr(i,e,n){let t=!1,r=!1,s=!1;for(let l=0,f=e.length;l<f;l++){const u=e[l];if(void 0!==u.POSITION&&(t=!0),void 0!==u.NORMAL&&(r=!0),void 0!==u.COLOR_0&&(s=!0),t&&r&&s)break}if(!t&&!r&&!s)return Promise.resolve(i);const o=[],a=[],c=[];for(let l=0,f=e.length;l<f;l++){const u=e[l];if(t){const p=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):i.attributes.position;o.push(p)}if(r){const p=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):i.attributes.normal;a.push(p)}if(s){const p=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):i.attributes.color;c.push(p)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[1],p=l[2];return t&&(i.morphAttributes.position=l[0]),r&&(i.morphAttributes.normal=u),s&&(i.morphAttributes.color=p),i.morphTargetsRelative=!0,i})}(i,e.targets,n):i})}var ve=he(4650),dt=function(i){return URL.createObjectURL(new Blob([i],{type:"text/javascript"}))};try{URL.revokeObjectURL(dt(""))}catch{dt=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var z=Uint8Array,W=Uint16Array,Ae=Uint32Array,Ie=new z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Me=new z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fe=new z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wt=function(i,e){for(var n=new W(31),t=0;t<31;++t)n[t]=e+=1<<i[t-1];var r=new Ae(n[30]);for(t=1;t<30;++t)for(var s=n[t];s<n[t+1];++s)r[s]=s-n[t]<<5|t;return[n,r]},qt=Wt(Ie,2),mt=qt[0],je=qt[1];mt[28]=258,je[258]=28;for(var Jt=Wt(Me,0)[0],Be=new W(32768),G=0;G<32768;++G){var we=(43690&G)>>>1|(21845&G)<<1;Be[G]=((65280&(we=(61680&(we=(52428&we)>>>2|(13107&we)<<2))>>>4|(3855&we)<<4))>>>8|(255&we)<<8)>>>1}var le=function(i,e,n){for(var t=i.length,r=0,s=new W(e);r<t;++r)++s[i[r]-1];var a,o=new W(e);for(r=0;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;if(n){a=new W(1<<e);var c=15-e;for(r=0;r<t;++r)if(i[r])for(var l=r<<4|i[r],f=e-i[r],u=o[i[r]-1]++<<f,p=u|(1<<f)-1;u<=p;++u)a[Be[u]>>>c]=l}else for(a=new W(t),r=0;r<t;++r)i[r]&&(a[r]=Be[o[i[r]-1]++]>>>15-i[r]);return a},Te=new z(288);for(G=0;G<144;++G)Te[G]=8;for(G=144;G<256;++G)Te[G]=9;for(G=256;G<280;++G)Te[G]=7;for(G=280;G<288;++G)Te[G]=8;var ze=new z(32);for(G=0;G<32;++G)ze[G]=5;var en=le(Te,9,1),nn=le(ze,5,1),Ve=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},oe=function(i,e,n){var t=e/8|0;return(i[t]|i[t+1]<<8)>>(7&e)&n},Xe=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(7&e)},Ne=function(i){return(i/8|0)+(7&i&&1)},Ke=function(i,e,n){var t=i.length;if(!t||n&&!n.l&&t<5)return e||new z(0);var r=!e||n,s=!n||n.i;n||(n={}),e||(e=new z(3*t));var o=function($){var fe=e.length;if($>fe){var re=new z(Math.max(2*fe,$));re.set(e),e=re}},a=n.f||0,c=n.p||0,l=n.b||0,f=n.l,u=n.d,p=n.m,d=n.n,m=8*t;do{if(!f){n.f=a=oe(i,c,1);var g=oe(i,c+1,3);if(c+=3,!g){var A=i[(v=Ne(c)+4)-4]|i[v-3]<<8,x=v+A;if(x>t){if(s)throw"unexpected EOF";break}r&&o(l+A),e.set(i.subarray(v,x),l),n.b=l+=A,n.p=c=8*x;continue}if(1==g)f=en,u=nn,p=9,d=5;else{if(2!=g)throw"invalid block type";var w=oe(i,c,31)+257,b=oe(i,c+10,15)+4,E=w+oe(i,c+5,31)+1;c+=14;for(var M=new z(E),I=new z(19),T=0;T<b;++T)I[Fe[T]]=oe(i,c+3*T,7);c+=3*b;var R=Ve(I),S=(1<<R)-1,C=le(I,R,1);for(T=0;T<E;){var v,P=C[oe(i,c,S)];if(c+=15&P,(v=P>>>4)<16)M[T++]=v;else{var _=0,k=0;for(16==v?(k=3+oe(i,c,3),c+=2,_=M[T-1]):17==v?(k=3+oe(i,c,7),c+=3):18==v&&(k=11+oe(i,c,127),c+=7);k--;)M[T++]=_}}var D=M.subarray(0,w),F=M.subarray(w);p=Ve(D),d=Ve(F),f=le(D,p,1),u=le(F,d,1)}if(c>m){if(s)throw"unexpected EOF";break}}r&&o(l+131072);for(var N=(1<<p)-1,X=(1<<d)-1,K=c;;K=c){var J=(_=f[Xe(i,c)&N])>>>4;if((c+=15&_)>m){if(s)throw"unexpected EOF";break}if(!_)throw"invalid length/literal";if(J<256)e[l++]=J;else{if(256==J){K=c,f=null;break}var Z=J-254;J>264&&(Z=oe(i,c,(1<<(te=Ie[T=J-257]))-1)+mt[T],c+=te);var Y=u[Xe(i,c)&X],H=Y>>>4;if(!Y)throw"invalid distance";if(c+=15&Y,F=Jt[H],H>3){var te=Me[H];F+=Xe(i,c)&(1<<te)-1,c+=te}if(c>m){if(s)throw"unexpected EOF";break}r&&o(l+131072);for(var U=l+Z;l<U;l+=4)e[l]=e[l-F],e[l+1]=e[l+1-F],e[l+2]=e[l+2-F],e[l+3]=e[l+3-F];l=U}}n.l=f,n.p=K,n.b=l,f&&(a=1,n.m=p,n.d=u,n.n=d)}while(!a);return l==e.length?e:function(i,e,n){(null==e||e<0)&&(e=0),(null==n||n>i.length)&&(n=i.length);var t=new(i instanceof W?W:i instanceof Ae?Ae:z)(n-e);return t.set(i.subarray(e,n)),t}(e,0,l)},We=new z(0);var It=typeof TextDecoder<"u"&&new TextDecoder;try{It.decode(We,{stream:!0})}catch{}function st(i,e,n){const t=n.length-i-1;if(e>=n[t])return t-1;if(e<=n[i])return i;let r=i,s=t,o=Math.floor((r+s)/2);for(;e<n[o]||e>=n[o+1];)e<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function Cr(i,e){let n=1;for(let r=2;r<=i;++r)n*=r;let t=1;for(let r=2;r<=e;++r)t*=r;for(let r=2;r<=i-e;++r)t*=r;return n/t}class zr extends h.Hyl{constructor(e,n,t,r,s){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<t.length;++o){const a=t[o];this.controlPoints[o]=new h.Ltg(a.x,a.y,a.z,a.w)}}getPoint(e,n=new h.Pa4){const t=n,s=function kr(i,e,n,t){const r=st(i,t,e),s=function Mt(i,e,n,t){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=n;++a){s[a]=e-t[i+1-a],o[a]=t[i+a]-e;let c=0;for(let l=0;l<a;++l){const f=o[l+1],u=s[a-l],p=r[l]/(f+u);r[l]=c+f*p,c=u*p}r[a]=c}return r}(r,t,i,e),o=new h.Ltg(0,0,0,0);for(let a=0;a<=i;++a){const c=n[r-i+a],l=s[a],f=c.w*l;o.x+=c.x*f,o.y+=c.y*f,o.z+=c.z*f,o.w+=c.w*l}return o}(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!==s.w&&s.divideScalar(s.w),t.set(s.x,s.y,s.z)}getTangent(e,n=new h.Pa4){const t=n,s=function Br(i,e,n,t,r){const s=function Or(i,e,n,t,r){const s=r<i?r:i,o=[],a=st(i,t,e),c=function Dr(i,e,n,t,r){const s=[];for(let u=0;u<=n;++u)s[u]=0;const o=[];for(let u=0;u<=t;++u)o[u]=s.slice(0);const a=[];for(let u=0;u<=n;++u)a[u]=s.slice(0);a[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let u=1;u<=n;++u){c[u]=e-r[i+1-u],l[u]=r[i+u]-e;let p=0;for(let d=0;d<u;++d){const m=l[d+1],g=c[u-d];a[u][d]=m+g;const v=a[d][u-1]/a[u][d];a[d][u]=p+m*v,p=g*v}a[u][u]=p}for(let u=0;u<=n;++u)o[0][u]=a[u][n];for(let u=0;u<=n;++u){let p=0,d=1;const m=[];for(let g=0;g<=n;++g)m[g]=s.slice(0);m[0][0]=1;for(let g=1;g<=t;++g){let v=0;const A=u-g,x=n-g;u>=g&&(m[d][0]=m[p][0]/a[x+1][A],v=m[d][0]*a[A][x]);const b=u-1<=x?g-1:n-u;for(let M=A>=-1?1:-A;M<=b;++M)m[d][M]=(m[p][M]-m[p][M-1])/a[x+1][A+M],v+=m[d][M]*a[A+M][x];u<=x&&(m[d][g]=-m[p][g-1]/a[x+1][u],v+=m[d][g]*a[u][x]),o[g][u]=v;const E=p;p=d,d=E}}let f=n;for(let u=1;u<=t;++u){for(let p=0;p<=n;++p)o[u][p]*=f;f*=n-u}return o}(a,t,i,s,e),l=[];for(let f=0;f<n.length;++f){const u=n[f].clone(),p=u.w;u.x*=p,u.y*=p,u.z*=p,l[f]=u}for(let f=0;f<=s;++f){const u=l[a-i].clone().multiplyScalar(c[f][0]);for(let p=1;p<=i;++p)u.add(l[a-i+p].clone().multiplyScalar(c[f][p]));o[f]=u}for(let f=s+1;f<=r+1;++f)o[f]=new h.Ltg(0,0,0);return o}(i,e,n,t,r);return function Fr(i){const e=i.length,n=[],t=[];for(let s=0;s<e;++s){const o=i[s];n[s]=new h.Pa4(o.x,o.y,o.z),t[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=n[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar(Cr(s,a)*t[a]));r[s]=o.divideScalar(t[0])}return r}(s)}(this.degree,this.knots,this.controlPoints,this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),1);return t.copy(s[1]).normalize(),t}}let O,V,ne;class bn extends h.aNw{constructor(e){super(e)}load(e,n,t,r){const s=this,o=""===s.path?h.Zp0.extractUrlBase(e):s.path,a=new h.hH6(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{n(s.parse(c,o))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},t,r)}parse(e,n){if(function Vr(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===_n(i,0,e.length)}(e))O=(new jr).parse(e);else{const r=_n(e);if(!function Xr(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function t(r){const s=i[r-1];return i=i.slice(n+r),n++,s}for(let r=0;r<e.length;++r)if(t(1)===e[r])return!1;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(Mn(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Mn(r));O=(new Hr).parse(r)}const t=new h.dpR(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Nr(t,this.manager).parse(O)}}class Nr{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){V=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),t=this.parseMaterials(n),r=this.parseDeformers(),s=(new Ur).parse(r);return this.parseScene(r,s,t),ne}parseConnections(){const e=new Map;return"Connections"in O&&O.Connections.connections.forEach(function(t){const r=t[0],s=t[1],o=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:r,relationship:o};e.get(s).children.push(c)}),e}parseImages(){const e={},n={};if("Video"in O.Objects){const t=O.Objects.Video;for(const r in t){const s=t[r];if(e[parseInt(r)]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c="string"==typeof s.Content&&""!==s.Content;if(a||c){const l=this.parseImage(t[r]);n[s.RelativeFilename||s.Filename]=l}}}}for(const t in e){const r=e[t];e[t]=void 0!==n[r]?n[r]:e[t].split("\\").pop()}return e}parseImage(e){const n=e.Content,t=e.RelativeFilename||e.Filename,r=t.slice(t.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",t),s="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof n)return"data:"+s+";base64,"+n;{const o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const n=new Map;if("Texture"in O.Objects){const t=O.Objects.Texture;for(const r in t){const s=this.parseTexture(t[r],e);n.set(parseInt(r),s)}}return n}parseTexture(e,n){const t=this.loadTexture(e,n);t.ID=e.id,t.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,a=void 0!==s?s.value:0;if(t.wrapS=0===(void 0!==r?r.value:0)?h.rpg:h.uWy,t.wrapT=0===a?h.rpg:h.uWy,"Scaling"in e){const c=e.Scaling.value;t.repeat.x=c[0],t.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;t.offset.x=c[0],t.offset.y=c[1]}return t}loadTexture(e,n){let t;const r=this.textureLoader.path,s=V.get(e.id).children;let o;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(t=n[s[0].ID],(0===t.indexOf("blob:")||0===t.indexOf("data:"))&&this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new h.xEZ):(c.setPath(this.textureLoader.path),o=c.load(t))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new h.xEZ):o=this.textureLoader.load(t);return this.textureLoader.setPath(r),o}parseMaterials(e){const n=new Map;if("Material"in O.Objects){const t=O.Objects.Material;for(const r in t){const s=this.parseMaterial(t[r],e);null!==s&&n.set(parseInt(r),s)}}return n}parseMaterial(e,n){const t=e.id,r=e.attrName;let s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!V.has(t))return null;const o=this.parseParameters(e,n,t);let a;switch(s.toLowerCase()){case"phong":a=new h.xoR;break;case"lambert":a=new h.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new h.xoR}return a.setValues(o),a.name=r,a}parseParameters(e,n,t){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new h.Ilk).fromArray(e.Diffuse.value):e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(r.color=(new h.Ilk).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new h.Ilk).fromArray(e.Emissive.value):e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(r.emissive=(new h.Ilk).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new h.Ilk).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new h.Ilk).fromArray(e.SpecularColor.value));const s=this;return V.get(t).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(n,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(n,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(n,o.ID),void 0!==r.map&&(r.map.encoding=h.knz);break;case"DisplacementColor":r.displacementMap=s.getTexture(n,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(n,o.ID),void 0!==r.emissiveMap&&(r.emissiveMap.encoding=h.knz);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(n,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(n,o.ID),void 0!==r.envMap&&(r.envMap.mapping=h.dSO,r.envMap.encoding=h.knz);break;case"SpecularColor":r.specularMap=s.getTexture(n,o.ID),void 0!==r.specularMap&&(r.specularMap.encoding=h.knz);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(n,o.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a)}}),r}getTexture(e,n){return"LayeredTexture"in O.Objects&&n in O.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=V.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in O.Objects){const t=O.Objects.Deformer;for(const r in t){const s=t[r],o=V.get(parseInt(r));if("Skin"===s.attrType){const a=this.parseSkeleton(o,t);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if("BlendShape"===s.attrType){const a={id:r};a.rawTargets=this.parseMorphTargets(o,t),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[r]=a}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const t=[];return e.children.forEach(function(r){const s=n[r.ID];if("Cluster"!==s.attrType)return;const o={ID:r.ID,indices:[],weights:[],transformLink:(new h.yGw).fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),t.push(o)}),{rawBones:t,bones:[]}}parseMorphTargets(e,n){const t=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=n[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=V.get(parseInt(s.ID)).children.filter(function(c){return void 0===c.relationship})[0].ID,t.push(a)}return t}parseScene(e,n,t){ne=new h.ZAu;const r=this.parseModels(e.skeletons,n,t),s=O.Objects.Model,o=this;r.forEach(function(c){o.setLookAtProperties(c,s[c.ID]),V.get(c.ID).parents.forEach(function(u){const p=r.get(u.ID);void 0!==p&&p.add(c)}),null===c.parent&&ne.add(c)}),this.bindSkeleton(e.skeletons,n,r),this.createAmbientLight(),ne.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=Rn(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=(new Gr).parse();1===ne.children.length&&ne.children[0].isGroup&&(ne.children[0].animations=a,ne=ne.children[0]),ne.animations=a}parseModels(e,n,t){const r=new Map,s=O.Objects.Model;for(const o in s){const a=parseInt(o),c=s[o],l=V.get(a);let f=this.buildSkeleton(l,e,a,c.attrName);if(!f){switch(c.attrType){case"Camera":f=this.createCamera(l);break;case"Light":f=this.createLight(l);break;case"Mesh":f=this.createMesh(l,n,t);break;case"NurbsCurve":f=this.createCurve(l,n);break;case"LimbNode":case"Root":f=new h.N$j;break;default:f=new h.ZAu}f.name=c.attrName?h.iUV.sanitizeNodeName(c.attrName):"",f.ID=a}this.getTransformData(f,c),r.set(a,f)}return r}buildSkeleton(e,n,t,r){let s=null;return e.parents.forEach(function(o){for(const a in n){const c=n[a];c.rawBones.forEach(function(l,f){if(l.ID===o.ID){const u=s;s=new h.N$j,s.matrixWorld.copy(l.transformLink),s.name=r?h.iUV.sanitizeNodeName(r):"",s.ID=t,c.bones[f]=s,null!==u&&s.add(u)}})}}),s}createCamera(e){let n,t;if(e.children.forEach(function(r){const s=O.Objects.NodeAttribute[r.ID];void 0!==s&&(t=s)}),void 0===t)n=new h.Tme;else{let r=0;void 0!==t.CameraProjectionType&&1===t.CameraProjectionType.value&&(r=1);let s=1;void 0!==t.NearPlane&&(s=t.NearPlane.value/1e3);let o=1e3;void 0!==t.FarPlane&&(o=t.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;void 0!==t.AspectWidth&&void 0!==t.AspectHeight&&(a=t.AspectWidth.value,c=t.AspectHeight.value);const l=a/c;let f=45;void 0!==t.FieldOfView&&(f=t.FieldOfView.value);const u=t.FocalLength?t.FocalLength.value:null;switch(r){case 0:n=new h.cPb(f,l,s,o),null!==u&&n.setFocalLength(u);break;case 1:n=new h.iKG(-a/2,a/2,c/2,-c/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),n=new h.Tme}}return n}createLight(e){let n,t;if(e.children.forEach(function(r){const s=O.Objects.NodeAttribute[r.ID];void 0!==s&&(t=s)}),void 0===t)n=new h.Tme;else{let r;r=void 0===t.LightType?0:t.LightType.value;let s=16777215;void 0!==t.Color&&(s=(new h.Ilk).fromArray(t.Color.value));let o=void 0===t.Intensity?1:t.Intensity.value/100;void 0!==t.CastLightOnObject&&0===t.CastLightOnObject.value&&(o=0);let a=0;void 0!==t.FarAttenuationEnd&&(a=void 0!==t.EnableFarAttenuation&&0===t.EnableFarAttenuation.value?0:t.FarAttenuationEnd.value);const c=1;switch(r){case 0:n=new h.cek(s,o,a,c);break;case 1:n=new h.Ox3(s,o);break;case 2:let l=Math.PI/3;void 0!==t.InnerAngle&&(l=h.M8C.degToRad(t.InnerAngle.value));let f=0;void 0!==t.OuterAngle&&(f=h.M8C.degToRad(t.OuterAngle.value),f=Math.max(f,1)),n=new h.PMe(s,o,a,l,f,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+t.LightType.value+", defaulting to a PointLight."),n=new h.cek(s,o)}void 0!==t.CastShadows&&1===t.CastShadows.value&&(n.castShadow=!0)}return n}createMesh(e,n,t){let r,s=null,o=null;const a=[];return e.children.forEach(function(c){n.has(c.ID)&&(s=n.get(c.ID)),t.has(c.ID)&&a.push(t.get(c.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new h.xoR({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(r=new h.TUv(s,o),r.normalizeSkinWeights()):r=new h.Kj0(s,o),r}createCurve(e,n){const t=e.children.reduce(function(s,o){return n.has(o.ID)&&(s=n.get(o.ID)),s},null),r=new h.nls({color:3342591,linewidth:1});return new h.x12(t,r)}getTransformData(e,n){const t={};"InheritType"in n&&(t.inheritType=parseInt(n.InheritType.value)),t.eulerOrder="RotationOrder"in n?Sn(n.RotationOrder.value):"ZYX","Lcl_Translation"in n&&(t.translation=n.Lcl_Translation.value),"PreRotation"in n&&(t.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(t.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(t.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(t.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(t.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(t.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(t.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(t.rotationPivot=n.RotationPivot.value),e.userData.transformData=t}setLookAtProperties(e,n){"LookAtProperty"in n&&V.get(e.ID).children.forEach(function(r){if("LookAtProperty"===r.relationship){const s=O.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(o),ne.add(e.target)):e.lookAt((new h.Pa4).fromArray(o))}}})}bindSkeleton(e,n,t){const r=this.parsePoseNodes();for(const s in e){const o=e[s];V.get(parseInt(o.ID)).parents.forEach(function(c){n.has(c.ID)&&V.get(c.ID).parents.forEach(function(u){t.has(u.ID)&&t.get(u.ID).bind(new h.OdW(o.bones),r[u.ID])})})}}parsePoseNodes(){const e={};if("Pose"in O.Objects){const n=O.Objects.Pose;for(const t in n)if("BindPose"===n[t].attrType&&n[t].NbPoseNodes>0){const r=n[t].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=(new h.yGw).fromArray(s.Matrix.a)}):e[r.Node]=(new h.yGw).fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in O&&"AmbientColor"in O.GlobalSettings){const e=O.GlobalSettings.AmbientColor.value,n=e[0],t=e[1],r=e[2];if(0!==n||0!==t||0!==r){const s=new h.Ilk(n,t,r);ne.add(new h.Mig(s,1))}}}}class Ur{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in O.Objects){const t=O.Objects.Geometry;for(const r in t){const s=V.get(parseInt(r)),o=this.parseGeometry(s,t[r],e);n.set(parseInt(r),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,t){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,t);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,t){const r=t.skeletons,s=[],o=e.parents.map(function(u){return O.Objects.Model[u.ID]});if(0===o.length)return;const a=e.children.reduce(function(u,p){return void 0!==r[p.ID]&&(u=r[p.ID]),u},null);e.children.forEach(function(u){void 0!==t.morphTargets[u.ID]&&s.push(t.morphTargets[u.ID])});const c=o[0],l={};"RotationOrder"in c&&(l.eulerOrder=Sn(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const f=Rn(l);return this.genGeometry(n,a,s,f)}genGeometry(e,n,t,r){const s=new h.u9r;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,n),a=this.genBuffers(o),c=new h.a$l(a.vertex,3);if(c.applyMatrix4(r),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new h.a$l(a.colors,3)),n&&(s.setAttribute("skinIndex",new h.qlB(a.weightsIndices,4)),s.setAttribute("skinWeight",new h.a$l(a.vertexWeights,4)),s.FBX_Deformer=n),a.normal.length>0){const l=(new h.Vkp).getNormalMatrix(r),f=new h.a$l(a.normal,3);f.applyNormalMatrix(l),s.setAttribute("normal",f)}if(a.uvs.forEach(function(l,f){let u="uv"+(f+1).toString();0===f&&(u="uv"),s.setAttribute(u,new h.a$l(a.uvs[f],2))}),o.material&&"AllSame"!==o.material.mappingType){let l=a.materialIndex[0],f=0;if(a.materialIndex.forEach(function(u,p){u!==l&&(s.addGroup(f,p-f,l),l=u,f=p)}),s.groups.length>0){const u=s.groups[s.groups.length-1],p=u.start+u.count;p!==a.materialIndex.length&&s.addGroup(p,a.materialIndex.length-p,l)}0===s.groups.length&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,t,r),s}parseGeoNode(e,n){const t={};if(t.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],t.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(t.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(t.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(t.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){t.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&t.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return t.weightTable={},null!==n&&(t.skeleton=n,n.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){void 0===t.weightTable[o]&&(t.weightTable[o]=[]),t.weightTable[o].push({id:s,weight:r.weights[a]})})})),t}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let t=0,r=0,s=!1,o=[],a=[],c=[],l=[],f=[],u=[];const p=this;return e.vertexIndices.forEach(function(d,m){let g,v=!1;d<0&&(d^=-1,v=!0);let A=[],x=[];if(o.push(3*d,3*d+1,3*d+2),e.color){const w=it(m,t,d,e.color);c.push(w[0],w[1],w[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(w){x.push(w.weight),A.push(w.id)}),x.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const w=[0,0,0,0],b=[0,0,0,0];x.forEach(function(E,M){let I=E,T=A[M];b.forEach(function(R,S,C){if(I>R){C[S]=I,I=R;const P=w[S];w[S]=T,T=P}})}),A=w,x=b}for(;x.length<4;)x.push(0),A.push(0);for(let w=0;w<4;++w)f.push(x[w]),u.push(A[w])}if(e.normal){const w=it(m,t,d,e.normal);a.push(w[0],w[1],w[2])}e.material&&"AllSame"!==e.material.mappingType&&(g=it(m,t,d,e.material)[0],g<0&&(p.negativeMaterialIndices=!0,g=0)),e.uv&&e.uv.forEach(function(w,b){const E=it(m,t,d,w);void 0===l[b]&&(l[b]=[]),l[b].push(E[0]),l[b].push(E[1])}),r++,v&&(r>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(n,e,o,g,a,c,l,f,u,r),t++,r=0,o=[],a=[],c=[],l=[],f=[],u=[])}),n}genFace(e,n,t,r,s,o,a,c,l,f){for(let u=2;u<f;u++)e.vertex.push(n.vertexPositions[t[0]]),e.vertex.push(n.vertexPositions[t[1]]),e.vertex.push(n.vertexPositions[t[2]]),e.vertex.push(n.vertexPositions[t[3*(u-1)]]),e.vertex.push(n.vertexPositions[t[3*(u-1)+1]]),e.vertex.push(n.vertexPositions[t[3*(u-1)+2]]),e.vertex.push(n.vertexPositions[t[3*u]]),e.vertex.push(n.vertexPositions[t[3*u+1]]),e.vertex.push(n.vertexPositions[t[3*u+2]]),n.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[4*(u-1)]),e.vertexWeights.push(c[4*(u-1)+1]),e.vertexWeights.push(c[4*(u-1)+2]),e.vertexWeights.push(c[4*(u-1)+3]),e.vertexWeights.push(c[4*u]),e.vertexWeights.push(c[4*u+1]),e.vertexWeights.push(c[4*u+2]),e.vertexWeights.push(c[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),n.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),n.material&&"AllSame"!==n.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),n.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[3*(u-1)]),e.normal.push(s[3*(u-1)+1]),e.normal.push(s[3*(u-1)+2]),e.normal.push(s[3*u]),e.normal.push(s[3*u+1]),e.normal.push(s[3*u+2])),n.uv&&n.uv.forEach(function(p,d){void 0===e.uvs[d]&&(e.uvs[d]=[]),e.uvs[d].push(a[d][0]),e.uvs[d].push(a[d][1]),e.uvs[d].push(a[d][2*(u-1)]),e.uvs[d].push(a[d][2*(u-1)+1]),e.uvs[d].push(a[d][2*u]),e.uvs[d].push(a[d][2*u+1])})}addMorphTargets(e,n,t,r){if(0===t.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;t.forEach(function(o){o.rawTargets.forEach(function(a){const c=O.Objects.Geometry[a.geoID];void 0!==c&&s.genMorphGeometry(e,n,c,r,a.name)})})}genMorphGeometry(e,n,t,r,s){const o=void 0!==n.PolygonVertexIndex?n.PolygonVertexIndex.a:[],a=void 0!==t.Vertices?t.Vertices.a:[],c=void 0!==t.Indexes?t.Indexes.a:[],f=new Float32Array(3*e.attributes.position.count);for(let m=0;m<c.length;m++){const g=3*c[m];f[g]=a[3*m],f[g+1]=a[3*m+1],f[g+2]=a[3*m+2]}const p=this.genBuffers({vertexIndices:o,vertexPositions:f}),d=new h.a$l(p.vertex,3);d.name=s||t.attrName,d.applyMatrix4(r),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.ReferenceInformationType;let s=[];return"IndexToDirect"===t&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:e.Normals.a,indices:s,mappingType:e.MappingInformationType,referenceType:t}}parseUVs(e){const t=e.ReferenceInformationType;let s=[];return"IndexToDirect"===t&&(s=e.UVIndex.a),{dataSize:2,buffer:e.UV.a,indices:s,mappingType:e.MappingInformationType,referenceType:t}}parseVertexColors(e){const t=e.ReferenceInformationType;let s=[];return"IndexToDirect"===t&&(s=e.ColorIndex.a),{dataSize:4,buffer:e.Colors.a,indices:s,mappingType:e.MappingInformationType,referenceType:t}}parseMaterialIndices(e){const n=e.MappingInformationType,t=e.ReferenceInformationType;if("NoMappingInformation"===n)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:t};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:n,referenceType:t}}parseNurbsGeometry(e){const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new h.u9r;const t=n-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let u=0,p=o.length;u<p;u+=4)s.push((new h.Ltg).fromArray(o,u));let a,c;if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){a=t,c=r.length-1-a;for(let u=0;u<t;++u)s.push(s[u])}const f=new zr(t,r,s,a,c).getPoints(12*s.length);return(new h.u9r).setFromPoints(f)}}class Gr{parse(){const e=[],n=this.parseClips();if(void 0!==n)for(const t in n){const s=this.addClip(n[t]);e.push(s)}return e}parseClips(){if(void 0===O.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=O.Objects.AnimationCurveNode,n=new Map;for(const t in e){const r=e[t];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const s={id:r.id,attr:r.attrName,curves:{}};n.set(s.id,s)}}return n}parseAnimationCurves(e){const n=O.Objects.AnimationCurve;for(const t in n){const r={id:n[t].id,times:n[t].KeyTime.a.map(Kr),values:n[t].KeyValueFloat.a},s=V.get(r.id);if(void 0!==s){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const n=O.Objects.AnimationLayer,t=new Map;for(const r in n){const s=[],o=V.get(parseInt(r));void 0!==o&&(o.children.forEach(function(c,l){if(e.has(c.ID)){const f=e.get(c.ID);if(void 0!==f.curves.x||void 0!==f.curves.y||void 0!==f.curves.z){if(void 0===s[l]){const u=V.get(c.ID).parents.filter(function(p){return void 0!==p.relationship})[0].ID;if(void 0!==u){const p=O.Objects.Model[u.toString()];if(void 0===p)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",c);const d={modelName:p.attrName?h.iUV.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ne.traverse(function(m){m.ID===p.id&&(d.transform=m.matrix,m.userData.transformData&&(d.eulerOrder=m.userData.transformData.eulerOrder))}),d.transform||(d.transform=new h.yGw),"PreRotation"in p&&(d.preRotation=p.PreRotation.value),"PostRotation"in p&&(d.postRotation=p.PostRotation.value),s[l]=d}}s[l]&&(s[l][f.attr]=f)}else if(void 0!==f.curves.morph){if(void 0===s[l]){const u=V.get(c.ID).parents.filter(function(A){return void 0!==A.relationship})[0].ID,p=V.get(u).parents[0].ID,d=V.get(p).parents[0].ID,m=V.get(d).parents[0].ID,g=O.Objects.Model[m],v={modelName:g.attrName?h.iUV.sanitizeNodeName(g.attrName):"",morphName:O.Objects.Deformer[u].attrName};s[l]=v}s[l][f.attr]=f}}}),t.set(parseInt(r),s))}return t}parseAnimStacks(e){const n=O.Objects.AnimationStack,t={};for(const r in n){const s=V.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);t[r]={name:n[r].attrName,layer:o}}return t}addClip(e){let n=[];const t=this;return e.layer.forEach(function(r){n=n.concat(t.generateTracks(r))}),new h.m7l(e.name,-1,n)}generateTracks(e){const n=[];let t=new h.Pa4,r=new h._fP,s=new h.Pa4;if(e.transform&&e.transform.decompose(t,r,s),t=t.toArray(),r=(new h.USm).setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,t,"position");void 0!==o&&n.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&n.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");void 0!==o&&n.push(o)}if(void 0!==e.DeformPercent){const o=this.generateMorphTrack(e);void 0!==o&&n.push(o)}return n}generateVectorTrack(e,n,t,r){const s=this.getTimesForAllAxes(n),o=this.getKeyframeTrackValues(s,n,t);return new h.yC1(e+"."+r,s,o)}generateRotationTrack(e,n,t,r,s,o){void 0!==n.x&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(h.M8C.degToRad)),void 0!==n.y&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(h.M8C.degToRad)),void 0!==n.z&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(h.M8C.degToRad));const a=this.getTimesForAllAxes(n),c=this.getKeyframeTrackValues(a,n,t);void 0!==r&&((r=r.map(h.M8C.degToRad)).push(o),r=(new h.USm).fromArray(r),r=(new h._fP).setFromEuler(r)),void 0!==s&&((s=s.map(h.M8C.degToRad)).push(o),s=(new h.USm).fromArray(s),s=(new h._fP).setFromEuler(s).invert());const l=new h._fP,f=new h.USm,u=[];for(let p=0;p<c.length;p+=3)f.set(c[p],c[p+1],c[p+2],o),l.setFromEuler(f),void 0!==r&&l.premultiply(r),void 0!==s&&l.multiply(s),l.toArray(u,p/3*4);return new h.iLg(e+".quaternion",a,u)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,t=n.values.map(function(s){return s/100}),r=ne.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new h.dUE(e.modelName+".morphTargetInfluences["+r+"]",n.times,t)}getTimesForAllAxes(e){let n=[];if(void 0!==e.x&&(n=n.concat(e.x.times)),void 0!==e.y&&(n=n.concat(e.y.times)),void 0!==e.z&&(n=n.concat(e.z.times)),n=n.sort(function(t,r){return t-r}),n.length>1){let t=1,r=n[0];for(let s=1;s<n.length;s++){const o=n[s];o!==r&&(n[t]=o,r=o,t++)}n=n.slice(0,t)}return n}getKeyframeTrackValues(e,n,t){const r=t,s=[];let o=-1,a=-1,c=-1;return e.forEach(function(l){if(n.x&&(o=n.x.times.indexOf(l)),n.y&&(a=n.y.times.indexOf(l)),n.z&&(c=n.z.times.indexOf(l)),-1!==o){const f=n.x.values[o];s.push(f),r[0]=f}else s.push(r[0]);if(-1!==a){const f=n.y.values[a];s.push(f),r[1]=f}else s.push(r[1]);if(-1!==c){const f=n.z.values[c];s.push(f),r[2]=f}else s.push(r[2])}),s}interpolateRotations(e){for(let n=1;n<e.values.length;n++){const t=e.values[n-1],r=e.values[n]-t,s=Math.abs(r);if(s>=180){const o=s/180,a=r/o;let c=t+a;const l=e.times[n-1],u=(e.times[n]-l)/o;let p=l+u;const d=[],m=[];for(;p<e.times[n];)d.push(p),p+=u,m.push(c),c+=a;e.times=Ln(e.times,n,d),e.values=Ln(e.values,n,m)}}}}class Hr{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new In,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,t=e.split(/[\r\n]+/);return t.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const c=r.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),l=r.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=r.match("^\\t{"+(n.currentIndent-1)+"}}");c?n.parseNodeBegin(r,c):l?n.parseNodeProperty(r,l,t[++s]):f?n.popStack():r.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,n){const t=n[1].trim().replace(/^"/,"").replace(/"$/,""),r=n[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:t},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(t,s):t in a?("PoseNode"===t?a.PoseNode.push(s):void 0!==a[t].id&&(a[t]={},a[t][a[t].id]=a[t]),""!==o.id&&(a[t][o.id]=s)):"number"==typeof o.id?(a[t]={},a[t][o.id]=s):"Properties70"!==t&&(a[t]="PoseNode"===t?[s]:s),"number"==typeof o.id&&(s.id=o.id),""!==o.name&&(s.attrName=o.name),""!==o.type&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let n=e[0];""!==e[0]&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let t="",r="";return e.length>1&&(t=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:n,name:t,type:r}}parseNodeProperty(e,n,t){let r=n[1].replace(/^"/,"").replace(/"$/,"").trim(),s=n[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===s&&(s=t.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){const c=s.split(",").slice(1),l=parseInt(c[0]),f=parseInt(c[1]);let u=s.split(",").slice(3);u=u.map(function(p){return p.trim().replace(/^"/,"")}),r="connections",s=[l,f],function Yr(i,e){for(let n=0,t=i.length,r=e.length;n<r;n++,t++)i[t]=e[n]}(s,u),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):"a"!==r?o[r]=s:o.a=s,this.setCurrentProp(o,r),"a"===r&&","!==s.slice(-1)&&(o.a=St(s))}else this.parseNodeSpecialProperty(e,r,s)}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,","!==e.slice(-1)&&(n.a=St(n.a))}parseNodeSpecialProperty(e,n,t){const r=t.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],c=r[3];let l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=St(l)}this.getPrevNode()[s]={type:o,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),s)}}class jr{parse(e){const n=new En(e);n.skip(23);const t=n.getUint32();if(t<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+t);const r=new In;for(;!this.endOfContent(n);){const s=this.parseNode(n,t);null!==s&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const t={},r=n>=7500?e.getUint64():e.getUint32(),s=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(0===r)return null;const c=[];for(let p=0;p<s;p++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",f=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(t.singleProperty=1===s&&e.getOffset()===r;r>e.getOffset();){const p=this.parseNode(e,n);null!==p&&this.parseSubNode(a,t,p)}return t.propertyList=c,"number"==typeof l&&(t.id=l),""!==f&&(t.attrName=f),""!==u&&(t.attrType=u),""!==a&&(t.name=a),t}parseSubNode(e,n,t){if(!0===t.singleProperty){const r=t.propertyList[0];Array.isArray(r)?(n[t.name]=t,t.a=r):n[t.name]=r}else if("Connections"===e&&"C"===t.name){const r=[];t.propertyList.forEach(function(s,o){0!==o&&r.push(s)}),void 0===n.connections&&(n.connections=[]),n.connections.push(r)}else if("Properties70"===t.name)Object.keys(t).forEach(function(s){n[s]=t[s]});else if("Properties70"===e&&"P"===t.name){let r=t.propertyList[0],s=t.propertyList[1];const o=t.propertyList[2],a=t.propertyList[3];let c;0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),c="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[t.propertyList[4],t.propertyList[5],t.propertyList[6]]:t.propertyList[4],n[r]={type:s,type2:o,flag:a,value:c}}else void 0===n[t.name]?"number"==typeof t.id?(n[t.name]={},n[t.name][t.id]=t):n[t.name]=t:"PoseNode"===t.name?(Array.isArray(n[t.name])||(n[t.name]=[n[t.name]]),n[t.name].push(t)):void 0===n[t.name][t.id]&&(n[t.name][t.id]=t)}parseProperty(e){const n=e.getString(1);let t;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(0===s)switch(n){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=function tt(i,e){return Ke((function(i){if(8!=(15&i[0])||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(32&i[1])throw"invalid zlib data: preset dictionaries not supported"}(i),i.subarray(2,-4)),e)}(new Uint8Array(e.getArrayBuffer(o))),c=new En(a.buffer);switch(n){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class En{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===n||n,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const n=[];for(let t=0;t<e;t++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let t=0;t<e;t++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),2147483648&n?(n=4294967295&~n,e=4294967295&~e,4294967295===e&&(n=n+1&4294967295),e=e+1&4294967295,-(4294967296*n+e)):4294967296*n+e}getInt64Array(e){const n=[];for(let t=0;t<e;t++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),4294967296*n+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let t=0;t<e;t++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let t=0;t<e;t++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){const n=this.offset;let t=new Uint8Array(this.dv.buffer,n,e);this.skip(e);const r=t.indexOf(0);return r>=0&&(t=new Uint8Array(this.dv.buffer,n,r)),this._textDecoder.decode(t)}}class In{add(e,n){this[e]=n}}function Mn(i){const n=i.match(/FBXVersion: (\d+)/);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Kr(i){return i/46186158e3}const Zr=[];function it(i,e,n,t){let r;switch(t.mappingType){case"ByPolygonVertex":r=i;break;case"ByPolygon":r=e;break;case"ByVertice":r=n;break;case"AllSame":r=t.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+t.mappingType)}"IndexToDirect"===t.referenceType&&(r=t.indices[r]);const s=r*t.dataSize;return function Wr(i,e,n,t){for(let r=n,s=0;r<t;r++,s++)i[s]=e[r];return i}(Zr,t.buffer,s,s+t.dataSize)}const Rt=new h.USm,Le=new h.Pa4;function Rn(i){const e=new h.yGw,n=new h.yGw,t=new h.yGw,r=new h.yGw,s=new h.yGw,o=new h.yGw,a=new h.yGw,c=new h.yGw,l=new h.yGw,f=new h.yGw,u=new h.yGw,p=new h.yGw,d=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(Le.fromArray(i.translation)),i.preRotation){const S=i.preRotation.map(h.M8C.degToRad);S.push(i.eulerOrder||h.USm.DEFAULT_ORDER),n.makeRotationFromEuler(Rt.fromArray(S))}if(i.rotation){const S=i.rotation.map(h.M8C.degToRad);S.push(i.eulerOrder||h.USm.DEFAULT_ORDER),t.makeRotationFromEuler(Rt.fromArray(S))}if(i.postRotation){const S=i.postRotation.map(h.M8C.degToRad);S.push(i.eulerOrder||h.USm.DEFAULT_ORDER),r.makeRotationFromEuler(Rt.fromArray(S)),r.invert()}i.scale&&s.scale(Le.fromArray(i.scale)),i.scalingOffset&&a.setPosition(Le.fromArray(i.scalingOffset)),i.scalingPivot&&o.setPosition(Le.fromArray(i.scalingPivot)),i.rotationOffset&&c.setPosition(Le.fromArray(i.rotationOffset)),i.rotationPivot&&l.setPosition(Le.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(u.copy(i.parentMatrix),f.copy(i.parentMatrixWorld));const m=n.clone().multiply(t).multiply(r),g=new h.yGw;g.extractRotation(f);const v=new h.yGw;v.copyPosition(f);const A=v.clone().invert().multiply(f),x=g.clone().invert().multiply(A),w=s,b=new h.yGw;if(0===d)b.copy(g).multiply(m).multiply(x).multiply(w);else if(1===d)b.copy(g).multiply(x).multiply(m).multiply(w);else{const C=(new h.yGw).scale((new h.Pa4).setFromMatrixScale(u)).clone().invert(),P=x.clone().multiply(C);b.copy(g).multiply(m).multiply(P).multiply(w)}const E=l.clone().invert(),M=o.clone().invert();let I=e.clone().multiply(c).multiply(l).multiply(n).multiply(t).multiply(r).multiply(E).multiply(a).multiply(o).multiply(s).multiply(M);const T=(new h.yGw).copyPosition(I),R=f.clone().multiply(T);return p.copyPosition(R),I=p.clone().multiply(b),I.premultiply(f.invert()),I}function Sn(i){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(i=i||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}function St(i){return i.split(",").map(function(n){return parseFloat(n)})}function _n(i,e,n){return void 0===e&&(e=0),void 0===n&&(n=i.byteLength),(new TextDecoder).decode(new Uint8Array(i,e,n))}function Ln(i,e,n){return i.slice(0,e).concat(n).concat(i.slice(e))}let qr=(()=>{class i{constructor(){}init(n){let t,r;const s=new h.SUY,o=new h.cPb(75,window.innerWidth/window.innerHeight,.1,3e3);o.position.set(100,200,300);const a=new h.xsS,c=new bn;a.add(o),c.load("assets/Chicken Dance.fbx",A=>{console.log(A),t=new h.Xcj(A),A.position.x=0,A.position.y=0,A.position.z=100,t.clipAction(A.animations[0]).play(),a.add(A)}),(new bn).load("assets/Angry.fbx",A=>{console.log(A),r=new h.Xcj(A),A.position.x=200,A.position.y=0,A.position.z=100,r.clipAction(A.animations[0]).play(),a.add(A)});const f=new h.CP7({antialias:!0});f.shadowMap.enabled=!0,n.appendChild(f.domElement),f.setSize(window.innerWidth,window.innerHeight),f.outputEncoding=h.knz;const u=new Bt(o,n);u.target.set(0,1,0),a.background=new h.Ilk(10526880),u.enableDamping=!0;const p=new h.vmT(16777215,4473924);p.position.set(0,200,0),a.add(p);const d=new h.Ox3(16777215);d.position.set(0,200,100),d.castShadow=!0,d.shadow.camera.top=180,d.shadow.camera.bottom=-100,d.shadow.camera.left=-120,d.shadow.camera.right=120,a.add(d);const m=new h.Kj0(new h._12(2e3,2e3),new h.xoR({color:10066329,depthWrite:!1}));m.rotation.x=-Math.PI/2,m.receiveShadow=!0,a.add(m);const g=new h.VLJ(2e3,20,0,0);a.add(g),console.log(o),window.addEventListener("dblclick",()=>{document.fullscreenElement?document.exitFullscreen():n.requestFullscreen()});const v=()=>{const A=s.getDelta();t&&t.update(A),r&&r.update(A),f.render(a,o),u.update(),window.requestAnimationFrame(v)};v()}}return i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=ve.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Qr=[{path:"",component:(()=>{class i{constructor(n){this.avatarService=n,this.version=Un.N.version}ngOnInit(){const n=document.querySelector("canvas")||null;this.init(n)}init(n){const t=new h.CP7({canvas:n});var r=new h.xsS,s=new h.cPb(75,window.innerWidth/window.innerHeight,.1,1e3),o=new h.Mig(16777215);r.add(o),s.position.z=10,t.setSize(window.innerWidth,window.innerHeight),new Bt(s,t.domElement).update();const c=new h.XvJ(1,.5,50,50),l=new h.RSm;for(let d=0;d<200;d++){const m=new h.Kj0(c,l);m.position.set(40*(Math.random()-.5),40*(Math.random()-.5),40*(Math.random()-.5)),m.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI);let g=Math.random();m.scale.set(g,g,g),r.add(m)}new Gn,function p(){requestAnimationFrame(p),t.render(r,s)}()}}return i.\u0275fac=function(n){return new(n||i)(ve.Y36(qr))},i.\u0275cmp=ve.Xpm({type:i,selectors:[["app-about"]],decls:1,vars:0,template:function(n,t){1&n&&ve._UZ(0,"canvas")},styles:[".work[_ngcontent-%COMP%]{position:absolute;color:#fff;top:0}.work-title[_ngcontent-%COMP%]{text-transform:uppercase;text-align:center;font-size:4vw;letter-spacing:2.6vw;font-family:Rajdhani,sans-serif;padding:2vw}.footer-menu.show[_ngcontent-%COMP%]{opacity:1}.footer-menu[_ngcontent-%COMP%]{z-index:100;padding:0;margin:0;position:fixed;bottom:15vh;width:100%;text-align:center;opacity:0;transition:.4s all ease-in-out}.footer-menu[_ngcontent-%COMP%]   .menu-items[_ngcontent-%COMP%]{padding:0;margin:0}.footer-menu[_ngcontent-%COMP%]   .menu-item[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;color:#fff;text-transform:uppercase;letter-spacing:.2vw;text-indent:.2vw;font-size:1vw;opacity:.5;padding-right:4vw;padding-left:4vw;-webkit-user-select:none;user-select:none}.menu-item[_ngcontent-%COMP%]:hover{opacity:1}.work-card[_ngcontent-%COMP%]{height:30vw;background-color:red;margin-left:2vw}.aframe[_ngcontent-%COMP%]{background-color:#ef2d5e}.aframe-title[_ngcontent-%COMP%]{transform:rotate(270deg);position:relative;top:13vw}.npm[_ngcontent-%COMP%]{background-color:#cd0000}"]}),i})(),data:{title:(0,Nn.J)("About")}}];let Jr=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=ve.oAB({type:i}),i.\u0275inj=ve.cJS({imports:[Ot.Bz.forChild(Qr),Ot.Bz]}),i})(),$r=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=ve.oAB({type:i}),i.\u0275inj=ve.cJS({imports:[Bn.ez,zn.aw,Jr]}),i})()}}]);